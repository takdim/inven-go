{% extends "base.html" %} {% block title %}{{ title }} - Inven-Go{% endblock %}
{% block content %}
<div class="container-fluid">
  <div class="row mb-4">
    <div class="col-md-8">
      <h2><i class="fas fa-tools"></i> {{ title }}</h2>
      <p class="text-muted mb-0">
        Menampilkan seluruh laporan kerusakan aset tetap.
      </p>
    </div>
  </div>

  <div class="card shadow-sm mb-3">
    <div class="card-header">
      <i class="fas fa-filter"></i> Filter Laporan
    </div>
    <div class="card-body">
      <form method="GET" action="{{ url_for('laporan.laporan_kerusakan') }}">
        <div class="row g-3">
          <div class="col-md-4">
            {{ form.aset_tetap_id.label(class="form-label") }}
            {{ form.aset_tetap_id(class="form-select") }}
          </div>
          <div class="col-md-2">
            {{ form.status.label(class="form-label") }}
            {{ form.status(class="form-select") }}
          </div>
          <div class="col-md-2">
            {{ form.tanggal_awal.label(class="form-label") }}
            {{ form.tanggal_awal(class="form-control", type="date") }}
          </div>
          <div class="col-md-2">
            {{ form.tanggal_akhir.label(class="form-label") }}
            {{ form.tanggal_akhir(class="form-control", type="date") }}
          </div>
          <div class="col-md-2 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">
              <i class="fas fa-search"></i> Tampilkan
            </button>
          </div>
        </div>
      </form>
      <div class="mt-3">
        <a href="{{ url_for('laporan.laporan_kerusakan') }}" class="btn btn-outline-danger btn-sm">
          <i class="fas fa-times"></i> Reset Filter
        </a>
      </div>
    </div>
  </div>

  <div class="mb-3">
    <span class="badge bg-secondary">Total Laporan: {{ laporan_list|length }}</span>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>No</th>
              <th>Tanggal Diketahui</th>
              <th>Kode Aset</th>
              <th>Nama Aset</th>
              <th>Nama Pengguna</th>
              <th>Lokasi</th>
              <th>Jenis Kerusakan</th>
              <th>Status</th>
              <th class="text-center">Aksi</th>
            </tr>
          </thead>
          <tbody>
            {% if laporan_list %}
              {% for item in laporan_list %}
              <tr>
                <td>{{ loop.index }}</td>
                <td>{{ item.tanggal_diketahui_rusak.strftime('%d %b %Y') if item.tanggal_diketahui_rusak else '-' }}</td>
                <td>{{ item.aset_tetap.kode_aset if item.aset_tetap else '-' }}</td>
                <td>{{ item.aset_tetap.nama_aset if item.aset_tetap else '-' }}</td>
                <td>{{ item.nama_pengguna or '-' }}</td>
                <td>{{ item.lokasi or '-' }}</td>
                <td>{{ item.jenis_kerusakan or '-' }}</td>
                <td>
                  {% if item.status == 'draft' %}
                    <span class="badge bg-secondary">Draft</span>
                  {% elif item.status == 'terkirim' %}
                    <span class="badge bg-info">Terkirim</span>
                  {% else %}
                    <span class="badge bg-success">Selesai</span>
                  {% endif %}
                </td>
                <td class="text-center">
                  <a href="{{ url_for('aset_tetap.laporan_kerusakan_cetak_pdf', id=item.id) }}" class="btn btn-sm btn-danger" title="Cetak PDF">
                    <i class="fas fa-file-pdf"></i>
                  </a>
                </td>
              </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="9" class="text-center text-muted py-4">
                  Belum ada data laporan kerusakan.
                </td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
